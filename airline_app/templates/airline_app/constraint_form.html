{% extends 'airline_app/base.html' %}
{% block title %}
  {% if form.instance.pk %}Editar{% else %}Crear{% endif %} Restricción - Sistema de Gestión de Aeropuerto
{% endblock title %}
{% block content %}
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
        <i class="fas fa-{% if form.instance.pk %}edit{% else %}plus{% endif %} mr-3"></i>
        {% if form.instance.pk %}Editar{% else %}Nueva{% endif %} Restricción
      </h1>
      <p class="text-gray-400 mt-2">Define reglas de negocio para la combinación de recursos</p>
    </div>
    <!-- Form -->
    <div class="bg-dark-900/50 backdrop-blur-lg border border-dark-800 rounded-xl p-8">
      <form method="post" class="space-y-6">
        {% csrf_token %}
        <!-- Non-field errors -->
        {% if form.non_field_errors %}
          <div class="bg-red-900/50 border border-red-700 text-red-200 rounded-lg p-4">
            <i class="fas fa-exclamation-circle mr-2"></i>
            {{ form.non_field_errors }}
          </div>
        {% endif %}
        <!-- Name -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">{{ form.name.label }}</label>
          {{ form.name }}
          {% if form.name.errors %}
            <p class="mt-1 text-sm text-red-400">{{ form.name.errors.0 }}</p>
          {% endif %}
        </div>
        <!-- Constraint Type -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">{{ form.constraint_type.label }}</label>
          {{ form.constraint_type }}
          {% if form.constraint_type.errors %}
            <p class="mt-1 text-sm text-red-400">{{ form.constraint_type.errors.0 }}</p>
          {% endif %}
          <p class="mt-2 text-sm text-gray-500">
            <strong>Co-requisito:</strong> Si se usa el recurso primario, DEBE incluirse el recurso relacionado<br />
            <strong>Exclusión Mutua:</strong> Si se usa el recurso primario, NO PUEDE usarse el recurso relacionado
          </p>
        </div>
        <!-- Description -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">{{ form.description.label }}</label>
          {{ form.description }}
          {% if form.description.errors %}
            <p class="mt-1 text-sm text-red-400">{{ form.description.errors.0 }}</p>
          {% endif %}
        </div>
        <!-- Primary Resource -->
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">{{ form.primary_resource_type.label }}</label>
            {{ form.primary_resource_type }}
            {% if form.primary_resource_type.errors %}
              <p class="mt-1 text-sm text-red-400">{{ form.primary_resource_type.errors.0 }}</p>
            {% endif %}
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Recurso Primario</label>
            <div id="primary-runway-group" style="display: none;">
              {{ form.primary_runway }}
            </div>
            <div id="primary-gate-group" style="display: none;">
              {{ form.primary_gate }}
            </div>
            <div id="primary-aircraft-group" style="display: none;">
              {{ form.primary_aircraft }}
            </div>
            <div id="primary-personnel-group" style="display: none;">
              {{ form.primary_personnel }}
            </div>
          </div>
        </div>
        <!-- Related Resource -->
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">{{ form.related_resource_type.label }}</label>
            {{ form.related_resource_type }}
            {% if form.related_resource_type.errors %}
              <p class="mt-1 text-sm text-red-400">{{ form.related_resource_type.errors.0 }}</p>
            {% endif %}
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Recurso Relacionado</label>
            <div id="related-runway-group" style="display: none;">
              {{ form.related_runway }}
            </div>
            <div id="related-gate-group" style="display: none;">
              {{ form.related_gate }}
            </div>
            <div id="related-aircraft-group" style="display: none;">
              {{ form.related_aircraft }}
            </div>
            <div id="related-personnel-group" style="display: none;">
              {{ form.related_personnel }}
            </div>
          </div>
        </div>
        <!-- Is Active -->
        <div class="flex items-center">
          {{ form.is_active }}
          <label class="ml-2 text-sm text-gray-300">{{ form.is_active.label }}</label>
        </div>
        <!-- Buttons -->
        <div class="flex items-center justify-end space-x-4 pt-6 border-t border-dark-800">
          <a href="{% url 'constraint_list' %}"
             class="px-6 py-3 bg-dark-800 text-gray-300 rounded-lg hover:bg-dark-700 transition">
            <i class="fas fa-times mr-2"></i>Cancelar
          </a>
          <button type="submit"
                  class="px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-medium rounded-lg hover:from-cyan-600 hover:to-blue-700 transition">
            <i class="fas fa-save mr-2"></i>
            {% if form.instance.pk %}Actualizar{% else %}Crear{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>
  <script>
    // Function to toggle resource selects based on type
    function togglePrimaryResource() {
      const typeSelect = document.getElementById('id_primary_resource_type');
      const type = typeSelect.value;
      
      // Hide all primary resource groups
      document.getElementById('primary-runway-group').style.display = 'none';
      document.getElementById('primary-gate-group').style.display = 'none';
      document.getElementById('primary-aircraft-group').style.display = 'none';
      document.getElementById('primary-personnel-group').style.display = 'none';
      
      // Show the selected type
      if (type === 'runway') {
        document.getElementById('primary-runway-group').style.display = 'block';
      } else if (type === 'gate') {
        document.getElementById('primary-gate-group').style.display = 'block';
      } else if (type === 'aircraft') {
        document.getElementById('primary-aircraft-group').style.display = 'block';
      } else if (type === 'personnel') {
        document.getElementById('primary-personnel-group').style.display = 'block';
      }
    }
    
    function toggleRelatedResource() {
      const typeSelect = document.getElementById('id_related_resource_type');
      const type = typeSelect.value;
      
      // Hide all related resource groups
      document.getElementById('related-runway-group').style.display = 'none';
      document.getElementById('related-gate-group').style.display = 'none';
      document.getElementById('related-aircraft-group').style.display = 'none';
      document.getElementById('related-personnel-group').style.display = 'none';
      
      // Show the selected type
      if (type === 'runway') {
        document.getElementById('related-runway-group').style.display = 'block';
      } else if (type === 'gate') {
        document.getElementById('related-gate-group').style.display = 'block';
      } else if (type === 'aircraft') {
        document.getElementById('related-aircraft-group').style.display = 'block';
      } else if (type === 'personnel') {
        document.getElementById('related-personnel-group').style.display = 'block';
      }
    }
    
    // Add event listeners
    document.addEventListener('DOMContentLoaded', function() {
      const primaryTypeSelect = document.getElementById('id_primary_resource_type');
      const relatedTypeSelect = document.getElementById('id_related_resource_type');
      
      if (primaryTypeSelect) {
        primaryTypeSelect.addEventListener('change', togglePrimaryResource);
        togglePrimaryResource(); // Initialize on load
      }
      
      if (relatedTypeSelect) {
        relatedTypeSelect.addEventListener('change', toggleRelatedResource);
        toggleRelatedResource(); // Initialize on load
      }
    });
  </script>
{% endblock content %}
